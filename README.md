# 暇ラン(暇人ランキング)

毎日0:00にHTLまたはLTLのトゥート数によるユーザーランキングを投稿するbot。どん廃アラートをユーザー全員で共有するイメージ。
一鯖一つの運用、そのbot鯖はインスタンス内のアカウントしかフォローしないという前提でUSE_HTLが使えます(が、HTLに外部の投稿が流れてきてもカウントはします)。

なおAUTOFOLLOW(自動フォロバ)は同一インスタンス外からのフォローには反応しません。

鯖缶か鯖缶に許可等を取った人、または黙認された人が運用してください。

kirishima.cloud(アスタルテ)用に作ったけど別にそれ以外でも動く

https://kirishima.cloud/@AstarteBot

リプライを送ると、リフォローとそのリプライをした人の1週間のアクティビティをDMで返信します。

## 使い方

### いるもの

Node.js(10と12で確認), yarnとbotアカウント、アクセストークン(read/write必須、AUTOFOLLOWを使うときはfollowも), MySQL(5.7で確認)

* `.env`を設定
* `yarn` 依存関係を正します
* `yarn db:init` MySQLのテーブルを作成します
* `yarn build` `tsc`(TypeScriptのため)
* `yarn start` スタート

任意でforever等を使って永続化します

## アプデ

ほとんどこないけど

* `yarn`
* `yarn build`
* `yarn start`

もしDBに何らかの変更がある場合は起動できなくなる(はず)なので指示に従ってください。

### .env概説

USE_HTL: ホームタイムラインベースでカウントします。つまり、そのbotアカウントがフォローしているユーザーだけでランキングを作ります。オフの時はローカルタイムライン(認証付き)を使用します。  
AUTOFOLLOW: 自動フォロバ機能です。そのインスタンス内のユーザーの時だけフォロバを返します。  
ASTARTE: アスタルテでは投稿にMarkdownが使えるので、それに対応してアンダーバーが上/下付き文字になるのを防いだり、グラフ画像を埋め込んだりするようになります。